// schema.prisma - Modelo de datos normalizado (3NF)
generator client {
  provider = "prisma-client"  // Moderno, recomendado para Prisma 7+
  output   = "../src/generated/client"  // Genera directamente en src/generated/client
}

datasource db {
  provider = "sqlite"  // Solo provider, sin url
}

model Vigilador {
  id           String    @id @default(uuid()) // UUID para unicidad global
  nombre       String    // Normalizado: Sin redundancias
  legajo       Int       @unique // Clave única para identificación
  ultimoPunto  Int       @default(0) // Estado secuencial
  rondaActiva  Boolean   @default(false) // Flag para lógica de negocio
  registros    Registro[] // Relación 1:N
}

model Punto {
  id       Int      @id // Secuencial simple (1-10)
  nombre   String   // e.g., "Punto 1"
  geo      Json?    // {lat: number, long: number} para validación futura
  registros Registro[] // Relación 1:N
}

model Registro {
  id              String    @id @default(uuid())
  vigiladorId     String    // FK
  puntoId         Int       // FK
  timestamp       DateTime  @default(now()) // Automático para trazabilidad
  geolocalizacion Json?     // Normalizado como JSON
  novedades       String?
  vigilador       Vigilador @relation(fields: [vigiladorId], references: [id])
  punto           Punto     @relation(fields: [puntoId], references: [id])

  @@index([vigiladorId, timestamp]) // Índice para queries rápidas por vigilador y tiempo
}