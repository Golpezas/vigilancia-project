// prisma/schema.prisma - Versión corregida para migración segura

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Vigilador {
  id           String    @id @default(uuid())
  nombre       String
  legajo       Int       @unique
  ultimoPunto  Int       @default(0)
  rondaActiva  Boolean   @default(false)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  servicioId   String
  servicio     Servicio  @relation(fields: [servicioId], references: [id])

  registros    Registro[]

  @@map("vigilador")
}

model Punto {
  id        Int       @id @default(autoincrement())
  nombre    String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  registros Registro[]

  @@map("punto")
}

model Registro {
  id              String    @id @default(uuid())
  vigiladorId     String
  puntoId         Int
  timestamp       DateTime  @default(now())
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  geolocalizacion String?
  novedades       String?

  vigilador       Vigilador @relation(fields: [vigiladorId], references: [id])
  punto           Punto     @relation(fields: [puntoId], references: [id])

  @@index([vigiladorId, timestamp])
  @@index([vigiladorId, createdAt])
  @@map("registro")
}

model Servicio {
  id          String    @id @default(uuid())
  nombre      String    @unique
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  vigiladores Vigilador[]   // ← Relación one-to-many (un servicio → muchos vigiladores)

  @@map("servicio")
}

model ServicioPunto {
  servicioId String
  puntoId    Int

  servicio   Servicio @relation(fields: [servicioId], references: [id])
  punto      Punto    @relation(fields: [puntoId], references: [id])

  @@id([servicioId, puntoId])
  @@map("servicio_punto")
}