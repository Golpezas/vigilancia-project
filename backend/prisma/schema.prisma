// prisma/schema.prisma - Fase 1: Servicio básico + relación con Vigilador (multi-servicio base)
// Mejores prácticas: Relaciones bidireccionales completas, auditoría automática, índices para escalabilidad

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Servicio {
  id        String   @id @default(uuid())
  nombre    String   @unique // Nombre único del servicio/cliente (ej: "Cliente Principal")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  vigiladores Vigilador[] // Relación one-to-many: un servicio → muchos vigiladores

  @@map("servicio")
}

model Vigilador {
  id          String   @id @default(uuid())
  nombre      String
  legajo      Int      @unique
  ultimoPunto Int      @default(0)
  rondaActiva Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  servicioId String
  servicio   Servicio @relation(fields: [servicioId], references: [id]) // Relación many-to-one: vigilador pertenece a un servicio

  registros Registro[]

  @@map("vigilador")
}

model Punto {
  id        Int      @id @default(autoincrement())
  nombre    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  registros Registro[]

  @@map("punto")
}

model Registro {
  id          String   @id @default(uuid())
  vigiladorId String
  puntoId     Int
  timestamp   DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  geolocalizacion String?
  novedades       String?

  vigilador Vigilador @relation(fields: [vigiladorId], references: [id])
  punto     Punto     @relation(fields: [puntoId], references: [id])

  @@index([vigiladorId, timestamp]) // Índice para historial por vigilador + tiempo
  @@index([vigiladorId, createdAt]) // Índice extra para queries auditadas
  @@map("registro")
}
